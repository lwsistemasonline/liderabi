// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CompanyGroup {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @map("name") @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(3)
  companies Company[] @relation("CompanyGroupRelation")

  @@map("company_groups")
}

model TypeCompany {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @map("name") @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(3)
  companies Company[] @relation("TypeCompanyRelation")

  @@map("type_companies")
}

model Company {
  id                              String                          @id @default(cuid()) @db.VarChar(26)
  name                            String                          @map("name") @db.VarChar(100)
  companyGroupId                  String                          @map("company_group_id") @db.VarChar(26)
  companyGroup                    CompanyGroup                    @relation("CompanyGroupRelation", fields: [companyGroupId], references: [id])
  parentCompanyId                 String?                         @map("parent_company_id") @db.VarChar(26)
  typeCompanyId                   String?                         @map("type_company_id") @db.VarChar(26)
  typeCompany                     TypeCompany?                    @relation("TypeCompanyRelation", fields: [typeCompanyId], references: [id])
  contactData                     Json?                           @map("contact_data") @db.JsonB
  addressData                     Json?                           @map("address_data") @db.JsonB
  credentialPowerBi               Json?                           @map("credential_power_bi") @db.JsonB
  createdAt                       DateTime                        @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt                       DateTime                        @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt                       DateTime?                       @map("deleted_at") @db.Timestamp(3)
  companySubscriptions            Company_Subscription[]          @relation("CompanySubscriptionRelation")
  companyBillings                 Company_Billing[]               @relation("CompanyBillingRelation")
  users                           User[]                          @relation("CompanyUserRelation")
  userCompanySubscriptionAccesses UserCompanySubscriptionAccess[] @relation("CompanyUserSubscriptionAccessRelation")
  userLogs                        UserLogs[]                      @relation("CompanyUserLogsRelation")
  companyParameters               Company_Parameters[]            @relation("CompanyParametersRelation")
  user_roles                      User_Roles[]                    @relation("CompanyUserRolesRelation")

  @@map("company")
}

model Company_Subscription {
  id                              String                          @id @default(cuid()) @db.VarChar(26)
  companyId                       String                          @map("company_id") @db.VarChar(26)
  company                         Company                         @relation("CompanySubscriptionRelation", fields: [companyId], references: [id])
  levelId                         String                          @map("level_id") @db.VarChar(26)
  level                           Level                           @relation("LevelRelation", fields: [levelId], references: [id])
  discount                        Decimal                         @default(0) @map("discount") @db.Decimal(10, 2)
  methodPaymentId                 String?                         @map("method_payment_id") @db.VarChar(26)
  typeChargeId                    String?                         @map("type_charge_id") @db.VarChar(26)
  cnpj                            String?                         @unique @map("cnpj") @db.VarChar(18)
  createdAt                       DateTime                        @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt                       DateTime                        @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt                       DateTime?                       @map("deleted_at") @db.Timestamp(3)
  methodPayment                   MethodPayment?                  @relation("MethodPaymentRelation", fields: [methodPaymentId], references: [id])
  typeCharge                      TypeCharge?                     @relation("TypeChargeRelation", fields: [typeChargeId], references: [id])
  companyBillings                 Company_Billing[]               @relation("CompanySubscriptionRelation")
  userCompanySubscriptionAccesses UserCompanySubscriptionAccess[] @relation("CompanySubscriptionAccessRelation")
  user_roles                      User_Roles[]                    @relation("CompanySubscriptionUserRolesRelation")

  @@map("company_subscriptions")
}

model MethodPayment {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @map("name") @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt            DateTime?              @map("deleted_at") @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("MethodPaymentRelation")

  @@map("method_payments")
}

model TypeCharge {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @map("name") @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt            DateTime?              @map("deleted_at") @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("TypeChargeRelation")

  @@map("type_charges")
}

model Level {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @map("name") @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt            DateTime?              @map("deleted_at") @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("LevelRelation")

  @@map("levels")
}

model Company_Billing {
  id             String               @id @default(cuid()) @db.VarChar(26)
  companyId      String               @map("company_id") @db.VarChar(26)
  company        Company              @relation("CompanyBillingRelation", fields: [companyId], references: [id])
  subscriptionId String               @map("subscription_id") @db.VarChar(26)
  subscription   Company_Subscription @relation("CompanySubscriptionRelation", fields: [subscriptionId], references: [id])
  dueDate        DateTime             @map("due_date") @db.Timestamp(3)
  billingDate    DateTime             @map("billing_date") @db.Timestamp(3)
  valueBilling   Decimal              @default(0) @map("value_billing") @db.Decimal(10, 2)
  paymentDate    DateTime?            @map("payment_date") @db.Timestamp(3)
  createdAt      DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt      DateTime             @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt      DateTime?            @map("deleted_at") @db.Timestamp(3)

  @@map("company_billings")
}

model User {
  id                              String                          @id @default(cuid()) @db.VarChar(26)
  companyId                       String                          @map("company_id") @db.VarChar(26)
  company                         Company                         @relation("CompanyUserRelation", fields: [companyId], references: [id])
  name                            String                          @map("name") @db.VarChar(100)
  mobileNumber                    String?                         @unique @map("mobile_number") @db.VarChar(20)
  telegramId                      String?                         @unique @map("telegram_id") @db.VarChar(26)
  image                           String?                         @map("image")
  createdAt                       DateTime                        @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt                       DateTime                        @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt                       DateTime?                       @map("deleted_at") @db.Timestamp(3)
  userCompanySubscriptionAccesses UserCompanySubscriptionAccess[] @relation("UserCompanySubscriptionAccessRelation")
  userLogs                        UserLogs[]                      @relation("UserLogsRelation")
  sessions                        Session[]                       @relation("UserSessionRelation")
  user_roles                      User_Roles[]                    @relation("UserUserRolesRelation")

  @@map("users")
}

model UserCompanySubscriptionAccess {
  id             String                @id @default(cuid()) @db.VarChar(26)
  userId         String                @map("user_id") @db.VarChar(26)
  user           User                  @relation("UserCompanySubscriptionAccessRelation", fields: [userId], references: [id])
  companyId      String                @map("company_id") @db.VarChar(26)
  company        Company               @relation("CompanyUserSubscriptionAccessRelation", fields: [companyId], references: [id])
  subscriptionId String?               @map("subscription_id") @db.VarChar(26)
  subscription   Company_Subscription? @relation("CompanySubscriptionAccessRelation", fields: [subscriptionId], references: [id])
  roleId         String?               @map("role_id") @db.VarChar(26)
  role           Roles?                @relation("RoleUserSubscriptionAccessRelation", fields: [roleId], references: [id])
  email          String?               @unique @map("email") @db.VarChar(100)
  emailVerified  DateTime?             @map("email_verified") @db.Timestamp(3)
  password       String?               @map("password") @db.VarChar(255)
  createdAt      DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt      DateTime              @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt      DateTime?             @map("deleted_at") @db.Timestamp(3)

  @@index([userId, companyId, subscriptionId])
  @@map("users_subscriptions")
}

model VerificationToken {
  id         String   @id @default(cuid()) @db.VarChar(26)
  identifier String   @map("identifier") @db.VarChar(100)
  token      String   @unique @map("token") @db.VarChar(100)
  expires    DateTime @map("expires") @db.Timestamp(3)
  createdAt  DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model UserLogs {
  id          String    @id @default(cuid())
  datelog     DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("datelog") @db.Timestamp(3)
  userId      String    @map("user_id") @db.VarChar(26)
  user        User      @relation("UserLogsRelation", fields: [userId], references: [id])
  companyId   String    @map("company_id") @db.VarChar(26)
  company     Company   @relation("CompanyUserLogsRelation", fields: [companyId], references: [id])
  ip_address  String    @map("ip_address") @db.VarChar(15)
  endpoint    String    @map("endpoint") @db.VarChar(255)
  method      String    @map("method") @db.VarChar(10)
  status_code Int       @map("status_code") @db.SmallInt
  entity      String    @map("entity") @db.VarChar(100)
  changes     Json?     @map("changes") @db.JsonB
  createdAt   DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt   DateTime? @map("deleted_at") @db.Timestamp(3)

  @@map("users_logs")
}

model Session {
  id           String   @id @default(cuid()) @db.VarChar(26)
  sessionToken String   @unique @map("session_token") @db.VarChar(512)
  userId       String   @map("user_id") @db.VarChar(26)
  user         User     @relation("UserSessionRelation", fields: [userId], references: [id])
  expires      DateTime @map("expires") @db.Timestamp(3)
  createdAt    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)

  @@map("sessions")
}

model Roles {
  id                              String                          @id @default(cuid()) @db.VarChar(26)
  name                            String                          @unique @map("name") @db.VarChar(100)
  createdAt                       DateTime                        @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt                       DateTime                        @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt                       DateTime?                       @map("deleted_at") @db.Timestamp(3)
  userCompanySubscriptionAccesses UserCompanySubscriptionAccess[] @relation("RoleUserSubscriptionAccessRelation")
  roles_objects                   Roles_Objects[]                 @relation("RoleRolesObjectsRelation")
  user_roles                      User_Roles[]                    @relation("RoleUserRolesRelation")

  @@index([name])
  @@map("roles")
}

model TypeObject {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @unique @map("name") @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(3)
  objects   Objects[] @relation("TypeObjectObjectsRelation")

  @@map("type_objects")
}

model Objects {
  id                 String               @id @default(cuid()) @db.VarChar(26)
  code               String               @unique @map("code") @db.VarChar(100)
  name               String               @map("name") @db.VarChar(100)
  description        String?              @map("description") @db.VarChar(255)
  price              Decimal              @default(0) @map("price") @db.Decimal(10, 2)
  typeObjectId       String               @map("type_object_id") @db.VarChar(26)
  typeObject         TypeObject           @relation("TypeObjectObjectsRelation", fields: [typeObjectId], references: [id])
  parentObjectId     String?              @map("parent_object_id") @db.VarChar(26)
  createdAt          DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt          DateTime             @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt          DateTime?            @map("deleted_at") @db.Timestamp(3)
  roles_objects      Roles_Objects[]      @relation("ObjectRolesObjectsRelation")
  user_roles_objects User_Roles_Objects[] @relation("ObjectUserRolesObjectsRelation")

  @@map("objects")
}

model Roles_Objects {
  id        String    @id @default(cuid()) @db.VarChar(26)
  roleId    String    @map("role_id") @db.VarChar(26)
  role      Roles     @relation("RoleRolesObjectsRelation", fields: [roleId], references: [id])
  objectId  String    @map("object_id") @db.VarChar(26)
  object    Objects   @relation("ObjectRolesObjectsRelation", fields: [objectId], references: [id])
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamp(3)

  @@map("roles_objects")
}

model Company_Parameters {
  id         String    @id @default(cuid()) @db.VarChar(26)
  companyId  String    @map("company_id") @db.VarChar(26)
  company    Company   @relation("CompanyParametersRelation", fields: [companyId], references: [id])
  parameters Json?     @map("parameters") @db.JsonB
  createdAt  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt  DateTime  @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt  DateTime? @map("deleted_at") @db.Timestamp(3)

  @@map("company_parameters")
}

//
// Parameter with key and value
// Example:
// {
//   "key": "value"
// }
//

model User_Roles {
  id                 String                @id @default(cuid()) @db.VarChar(26)
  companyId          String                @map("company_id") @db.VarChar(26)
  company            Company               @relation("CompanyUserRolesRelation", fields: [companyId], references: [id])
  subscriptionId     String?               @map("subscription_id") @db.VarChar(26)
  subscription       Company_Subscription? @relation("CompanySubscriptionUserRolesRelation", fields: [subscriptionId], references: [id])
  userId             String                @map("user_id") @db.VarChar(26)
  user               User                  @relation("UserUserRolesRelation", fields: [userId], references: [id])
  roleId             String                @map("role_id") @db.VarChar(26)
  role               Roles                 @relation("RoleUserRolesRelation", fields: [roleId], references: [id])
  createdAt          DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt          DateTime              @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt          DateTime?             @map("deleted_at") @db.Timestamp(3)
  user_roles_objects User_Roles_Objects[]  @relation("UserRolesUserRolesObjectsRelation")

  @@map("users_roles")
}

model User_Roles_Objects {
  id         String     @id @default(cuid()) @db.VarChar(26)
  userRoleId String     @map("user_role_id") @db.VarChar(26)
  userRole   User_Roles @relation("UserRolesUserRolesObjectsRelation", fields: [userRoleId], references: [id])
  objectId   String     @map("object_id") @db.VarChar(26)
  object     Objects    @relation("ObjectUserRolesObjectsRelation", fields: [objectId], references: [id])
  createdAt  DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at") @db.Timestamp(3)
  updatedAt  DateTime   @updatedAt @map("updated_at") @db.Timestamp(3)
  deletedAt  DateTime?  @map("deleted_at") @db.Timestamp(3)

  @@map("users_roles_objects")
}
