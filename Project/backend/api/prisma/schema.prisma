// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CompanyGroup {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @db.Timestamp(3)
  deletedAt DateTime? @db.Timestamp(3)
  companies Company[] @relation("CompanyGroupRelation")

  @@map("company_groups")
}

model TypeCompany {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @db.Timestamp(3)
  deletedAt DateTime? @db.Timestamp(3)
  companies Company[] @relation("TypeCompanyRelation")

  @@map("type_companies")
}

model Company {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @db.VarChar(100)
  companyGroupId       String                 @db.VarChar(26)
  companyGroup         CompanyGroup           @relation("CompanyGroupRelation", fields: [companyGroupId], references: [id])
  parentCompanyId      String?                @db.VarChar(26)
  typeCompanyId        String?                @db.VarChar(26)
  typeCompany          TypeCompany?           @relation("TypeCompanyRelation", fields: [typeCompanyId], references: [id])
  contactData          Json?                  @db.JsonB
  addressData          Json?                  @db.JsonB
  credentialPowerBi    Json?                  @db.JsonB
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @db.Timestamp(3)
  deletedAt            DateTime?              @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("CompanySubscriptionRelation")
  companyBillings      Company_Billing[]      @relation("CompanyBillingRelation")
  users                User[]                 @relation("CompanyUserRelation")
  userLogs             UserLogs[]             @relation("CompanyUserLogsRelation")
  companyParameters    Company_Parameters[]   @relation("CompanyParametersRelation")
  user_roles           User_Roles[]           @relation("CompanyUserRolesRelation")
  reportWorkspaces     Report_Workspace[]     @relation("CompanyReportWorkspaceRelation")
  reportUserCompanies  Report_User_Company[]  @relation("CompanyReportUserCompanyRelation")
  reports              Report[]               @relation("CompanyReportRelation")

  @@map("company")
}

model Company_Subscription {
  id              String            @id @default(cuid()) @db.VarChar(26)
  companyId       String            @db.VarChar(26)
  company         Company           @relation("CompanySubscriptionRelation", fields: [companyId], references: [id])
  levelId         String            @db.VarChar(26)
  level           Level             @relation("LevelRelation", fields: [levelId], references: [id])
  discount        Decimal           @default(0) @db.Decimal(10, 2)
  methodPaymentId String?           @db.VarChar(26)
  typeChargeId    String?           @db.VarChar(26)
  cnpj            String?           @unique @db.VarChar(18)
  createdAt       DateTime          @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt       DateTime          @updatedAt @db.Timestamp(3)
  deletedAt       DateTime?         @db.Timestamp(3)
  methodPayment   MethodPayment?    @relation("MethodPaymentRelation", fields: [methodPaymentId], references: [id])
  typeCharge      TypeCharge?       @relation("TypeChargeRelation", fields: [typeChargeId], references: [id])
  companyBillings Company_Billing[] @relation("CompanySubscriptionRelation")
  user_roles      User_Roles[]      @relation("CompanySubscriptionUserRolesRelation")

  @@map("company_subscriptions")
}

model MethodPayment {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @db.Timestamp(3)
  deletedAt            DateTime?              @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("MethodPaymentRelation")

  @@map("method_payments")
}

model TypeCharge {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @db.Timestamp(3)
  deletedAt            DateTime?              @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("TypeChargeRelation")

  @@map("type_charges")
}

model Level {
  id                   String                 @id @default(cuid()) @db.VarChar(26)
  name                 String                 @db.VarChar(100)
  createdAt            DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt            DateTime               @updatedAt @db.Timestamp(3)
  deletedAt            DateTime?              @db.Timestamp(3)
  companySubscriptions Company_Subscription[] @relation("LevelRelation")

  @@map("levels")
}

model Company_Billing {
  id             String               @id @default(cuid()) @db.VarChar(26)
  companyId      String               @db.VarChar(26)
  company        Company              @relation("CompanyBillingRelation", fields: [companyId], references: [id])
  subscriptionId String               @db.VarChar(26)
  subscription   Company_Subscription @relation("CompanySubscriptionRelation", fields: [subscriptionId], references: [id])
  dueDate        DateTime             @db.Timestamp(3)
  billingDate    DateTime             @db.Timestamp(3)
  valueBilling   Decimal              @default(0) @db.Decimal(10, 2)
  paymentDate    DateTime?            @db.Timestamp(3)
  createdAt      DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt      DateTime             @updatedAt @db.Timestamp(3)
  deletedAt      DateTime?            @db.Timestamp(3)

  @@map("company_billings")
}

model User {
  id                  String                @id @default(cuid()) @db.VarChar(26)
  companyId           String                @db.VarChar(26)
  company             Company               @relation("CompanyUserRelation", fields: [companyId], references: [id])
  name                String                @db.VarChar(100)
  mobileNumber        String?               @unique @db.VarChar(20)
  telegramId          String?               @unique @db.VarChar(26)
  image               String?
  roleId              String?               @db.VarChar(26)
  role                Roles?                @relation("RoleUserRelation", fields: [roleId], references: [id])
  email               String?               @unique @db.VarChar(100)
  emailVerified       DateTime?             @db.Timestamp(3)
  password            String?               @db.VarChar(255)
  createdAt           DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt           DateTime              @updatedAt @db.Timestamp(3)
  deletedAt           DateTime?             @db.Timestamp(3)
  userLogs            UserLogs[]            @relation("UserLogsRelation")
  sessions            Session[]             @relation("UserSessionRelation")
  user_roles          User_Roles[]          @relation("UserUserRolesRelation")
  reportUserCompanies Report_User_Company[] @relation("UserReportUserCompanyRelation")

  @@map("users")
}

model Report_Workspace {
  id          String    @id @default(cuid()) @db.VarChar(26)
  name        String    @db.VarChar(100)
  workspaceId String    @db.VarChar(26)
  companyId   String    @db.VarChar(26)
  company     Company   @relation("CompanyReportWorkspaceRelation", fields: [companyId], references: [id])
  createdAt   DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt   DateTime  @updatedAt @db.Timestamp(3)
  deletedAt   DateTime? @db.Timestamp(3)
  reports     Report[]  @relation("ReportWorkspaceRelation")

  @@map("report_workspaces")
}

model Report {
  id                  String                @id @default(cuid()) @db.VarChar(26)
  name                String                @db.VarChar(100)
  workspaceId         String                @db.VarChar(26)
  workspace           Report_Workspace      @relation("ReportWorkspaceRelation", fields: [workspaceId], references: [id])
  reportId            String                @db.VarChar(26)
  embedUrl            String                @db.VarChar(255)
  datasetId           String                @db.VarChar(50)
  companyId           String                @db.VarChar(26)
  company             Company               @relation("CompanyReportRelation", fields: [companyId], references: [id])
  createdAt           DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt           DateTime              @updatedAt @db.Timestamp(3)
  deletedAt           DateTime?             @db.Timestamp(3)
  reportUserCompanies Report_User_Company[] @relation("ReportReportUserCompanyRelation")

  @@map("reports")
}

model Report_User_Company {
  id        String    @id @default(cuid()) @db.VarChar(26)
  userId    String    @db.VarChar(26)
  user      User      @relation("UserReportUserCompanyRelation", fields: [userId], references: [id])
  companyId String    @db.VarChar(26)
  company   Company   @relation("CompanyReportUserCompanyRelation", fields: [companyId], references: [id])
  reportId  String    @db.VarChar(26)
  report    Report    @relation("ReportReportUserCompanyRelation", fields: [reportId], references: [id])
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @db.Timestamp(3)
  deletedAt DateTime? @db.Timestamp(3)

  @@map("report_user_company")
}

model VerificationToken {
  id         String   @id @default(cuid()) @db.VarChar(26)
  identifier String   @db.VarChar(100)
  token      String   @unique @db.VarChar(100)
  expires    DateTime @db.Timestamp(3)
  createdAt  DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model UserLogs {
  id          String    @id @default(cuid())
  datelog     DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  userId      String    @db.VarChar(26)
  user        User      @relation("UserLogsRelation", fields: [userId], references: [id])
  companyId   String    @db.VarChar(26)
  company     Company   @relation("CompanyUserLogsRelation", fields: [companyId], references: [id])
  ip_address  String    @db.VarChar(15)
  endpoint    String    @db.VarChar(255)
  method      String    @db.VarChar(10)
  status_code Int       @db.SmallInt
  entity      String    @db.VarChar(100)
  changes     Json?     @db.JsonB
  createdAt   DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt   DateTime  @updatedAt @db.Timestamp(3)
  deletedAt   DateTime? @db.Timestamp(3)

  @@map("users_logs")
}

model Session {
  id           String   @id @default(cuid()) @db.VarChar(26)
  sessionToken String   @unique @db.VarChar(512)
  userId       String   @db.VarChar(26)
  user         User     @relation("UserSessionRelation", fields: [userId], references: [id])
  expires      DateTime @db.Timestamp(3)
  createdAt    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)

  @@map("sessions")
}

model Roles {
  id            String          @id @default(cuid()) @db.VarChar(26)
  name          String          @unique @db.VarChar(100)
  createdAt     DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt     DateTime        @updatedAt @db.Timestamp(3)
  deletedAt     DateTime?       @db.Timestamp(3)
  roles_objects Roles_Objects[] @relation("RoleRolesObjectsRelation")
  user_roles    User_Roles[]    @relation("RoleUserRolesRelation")
  users         User[]          @relation("RoleUserRelation")

  @@index([name])
  @@map("roles")
}

model TypeObject {
  id        String    @id @default(cuid()) @db.VarChar(26)
  name      String    @unique @db.VarChar(100)
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @db.Timestamp(3)
  deletedAt DateTime? @db.Timestamp(3)
  objects   Objects[] @relation("TypeObjectObjectsRelation")

  @@map("type_objects")
}

model Objects {
  id                 String               @id @default(cuid()) @db.VarChar(26)
  code               String               @unique @db.VarChar(100)
  name               String               @db.VarChar(100)
  description        String?              @db.VarChar(255)
  price              Decimal              @default(0) @db.Decimal(10, 2)
  typeObjectId       String               @db.VarChar(26)
  typeObject         TypeObject           @relation("TypeObjectObjectsRelation", fields: [typeObjectId], references: [id])
  parentObjectId     String?              @db.VarChar(26)
  createdAt          DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt          DateTime             @updatedAt @db.Timestamp(3)
  deletedAt          DateTime?            @db.Timestamp(3)
  roles_objects      Roles_Objects[]      @relation("ObjectRolesObjectsRelation")
  user_roles_objects User_Roles_Objects[] @relation("ObjectUserRolesObjectsRelation")

  @@map("objects")
}

model Roles_Objects {
  id        String    @id @default(cuid()) @db.VarChar(26)
  roleId    String    @db.VarChar(26)
  role      Roles     @relation("RoleRolesObjectsRelation", fields: [roleId], references: [id])
  objectId  String    @db.VarChar(26)
  object    Objects   @relation("ObjectRolesObjectsRelation", fields: [objectId], references: [id])
  createdAt DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt DateTime  @updatedAt @db.Timestamp(3)
  deletedAt DateTime? @db.Timestamp(3)

  @@map("roles_objects")
}

model Company_Parameters {
  id         String    @id @default(cuid()) @db.VarChar(26)
  companyId  String    @db.VarChar(26)
  company    Company   @relation("CompanyParametersRelation", fields: [companyId], references: [id])
  parameters Json?     @db.JsonB
  createdAt  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt  DateTime  @updatedAt @db.Timestamp(3)
  deletedAt  DateTime? @db.Timestamp(3)

  @@map("company_parameters")
}

//
// Parameter with key and value
// Example:
// {
//   "key": "value"
// }
//

model User_Roles {
  id                 String                @id @default(cuid()) @db.VarChar(26)
  companyId          String                @db.VarChar(26)
  company            Company               @relation("CompanyUserRolesRelation", fields: [companyId], references: [id])
  subscriptionId     String?               @db.VarChar(26)
  subscription       Company_Subscription? @relation("CompanySubscriptionUserRolesRelation", fields: [subscriptionId], references: [id])
  userId             String                @db.VarChar(26)
  user               User                  @relation("UserUserRolesRelation", fields: [userId], references: [id])
  roleId             String                @db.VarChar(26)
  role               Roles                 @relation("RoleUserRolesRelation", fields: [roleId], references: [id])
  createdAt          DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt          DateTime              @updatedAt @db.Timestamp(3)
  deletedAt          DateTime?             @db.Timestamp(3)
  user_roles_objects User_Roles_Objects[]  @relation("UserRolesUserRolesObjectsRelation")

  @@map("users_roles")
}

model User_Roles_Objects {
  id         String     @id @default(cuid()) @db.VarChar(26)
  userRoleId String     @db.VarChar(26)
  userRole   User_Roles @relation("UserRolesUserRolesObjectsRelation", fields: [userRoleId], references: [id])
  objectId   String     @db.VarChar(26)
  object     Objects    @relation("ObjectUserRolesObjectsRelation", fields: [objectId], references: [id])
  createdAt  DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(3)
  updatedAt  DateTime   @updatedAt @db.Timestamp(3)
  deletedAt  DateTime?  @db.Timestamp(3)

  @@map("users_roles_objects")
}
